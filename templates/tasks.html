<!DOCTYPE html>
<html>
<head>
    <title>Joys och Johannas ToDoApp</title>
    <link rel="stylesheet" type="text/css" href="/static/style.css">
</head>
<body>
    <h1>Task List</h1>
    <table>
        <thead>
            <tr>
                <th class="sortable" onclick="sortTable(0)">ID</th>
                <th class="sortable" onclick="sortTable(1)">Description</th>
                <th class="sortable" onclick="sortTable(2)">Category</th>
                <th class="sortable" onclick="sortTable(3)">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.id }}</td>
                <td>
                    <input type="checkbox" name="completed" {% if task.status == 'completed' %}checked{% endif %} onclick="toggleCompleted({{ task.id }})">
                    <span id="task_{{ task.id }}" {% if task.status == 'completed' %}style="text-decoration: line-through;"{% endif %}>
                        {{ task.description }}
                    </span>
                </td>
                <td>{{ task.category }}</td>
                <td>{{ task.status }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Lägg till ny task</h2>
    <form action="/add_task" method="post">
        <label for="description">Beskrivning:</label>
        <input type="text" id="description" name="description" required>
        <br>
        <label for="category">Kategori:</label>
        <input type="text" id="category" name="category" required>
        <br>
        <input type="submit" value="Lägg till uppgift">
    </form>
    <script>
        function toggleCompleted(taskId) {
            // Skicka en AJAX-förfrågan till servern för att markera uppgiften som "completed"
            fetch(`/tasks/${taskId}/complete`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                }
            }).then(response => {
                if (response.ok) {
                    // Uppdatera visningen i webbläsaren
                    const taskElement = document.getElementById(`task_${taskId}`);
                    if (taskElement.style.textDecoration === 'line-through') {
                        taskElement.style.textDecoration = 'none';
                    } else {
                        taskElement.style.textDecoration = 'line-through';
                    }
                }
            });
        }
    </script>
</body>
</html>

